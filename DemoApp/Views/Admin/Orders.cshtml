@model IEnumerable<DemoApp.Models.DangKyKhoaHoc>

@{
    ViewData["Title"] = "Quản lý đơn đăng ký";
}

@section Styles {
    <link rel="stylesheet" href="~/css/admin-dashboard.css" />
}

<div class="admin-wrapper">
    @* ==== COPY PHẦN ADMIN HEADER + SIDEBAR TỪ TRANG Dashboard.cshtml VÀO ĐÂY ====
       - Nhớ sửa class "active" ở menu:
         + /admin/dashboard       -> nav-item
         + /admin/quanlidonhang   -> nav-item active
    *@

    <!-- MAIN CONTENT: QUẢN LÝ ĐƠN ĐĂNG KÝ -->
    <main class="admin-main" id="adminMain">
        <div class="admin-content">

            <div class="admin-page-header">
                <div>
                    <h2 class="admin-page-title">Quản lý đơn đăng ký khóa học</h2>
                    <p class="admin-page-subtitle">
                        Danh sách học viên đăng ký khóa học. Có thể xem chi tiết, cập nhật trạng thái.
                    </p>
                </div>
            </div>

            <div class="filter-bar">
                <div class="filter-group">
                    <label>Trạng thái</label>
                    <select class="filter-select">
                        <option value="">Tất cả</option>
                        <option value="DangHoc">Đang học</option>
                        <option value="HoanThanh">Hoàn thành</option>
                        <option value="Huy">Hủy</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Khoảng thời gian</label>
                    <select class="filter-select">
                        <option>7 ngày gần đây</option>
                        <option>30 ngày gần đây</option>
                        <option>3 tháng</option>
                        <option>Tất cả</option>
                    </select>
                </div>
            </div>

            <div class="admin-table-wrapper">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Học viên</th>
                            <th>Khóa học</th>
                            <th>Ngày đăng ký</th>
                            <th>Trạng thái</th>
                            <th class="text-end">Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null && Model.Any())
                        {
                            foreach (var dk in Model)
                            {
                                <tr>
                                    <td>@dk.Id</td>
                                    <td>
                                        <div class="table-main-text">@dk.user?.FullName</div>
                                        <div class="table-sub-text">@dk.user?.Email</div>
                                    </td>
                                    <td>
                                        <div class="table-main-text">@dk.KhoaHoc?.TenKhoaHoc</div>
                                        <div class="table-sub-text">@dk.KhoaHoc?.MaKhoaHoc</div>
                                    </td>
                                    <td>@dk.NgayDangKy.ToString("dd/MM/yyyy HH:mm")</td>
                                    <td>
                                        @if (dk.TrangThai == "DangHoc")
                                        {
                                            <span class="badge-status info">Đang học</span>
                                        }
                                        else if (dk.TrangThai == "HoanThanh")
                                        {
                                            <span class="badge-status success">Hoàn thành</span>
                                        }
                                        else if (dk.TrangThai == "Huy")
                                        {
                                            <span class="badge-status danger">Hủy</span>
                                        }
                                        else
                                        {
                                            <span class="badge-status neutral">@dk.TrangThai</span>
                                        }
                                    </td>
                                    <td class="text-end">
                                        <div class="table-actions">
                                            <a href="/admin/donhang/details/@dk.Id" class="link-action">Xem</a>
                                            <span class="divider">|</span>
                                            <a href="/admin/donhang/update-status/@dk.Id" class="link-action">Cập nhật</a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="6" class="text-center text-muted">
                                    Chưa có đơn đăng ký nào.
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

        </div>
    </main>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="~/js/admin-dashboard.js"></script>
}
